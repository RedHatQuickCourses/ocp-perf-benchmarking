<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Network Performance Testing with k8s-netperf :: OpenShift performance benchmarking guide</title>
    <link rel="prev" href="section1.html">
    <link rel="next" href="section3.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift performance benchmarking guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-perf-benchmarking/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-perf-benchmarking" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift performance benchmarking guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Introduction to Performance Benchmarking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Kubernetes/OpenShift performance landscape</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter2/index.html">Monitoring OpenShift Performance with the Built-in Stack</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section1.html">Hands-On Lab: Exploring the OpenShift Monitoring Stack</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter3/index.html">Overview of Benchmarking Suites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section1.html">Kubernetes-native benchmarking tools</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Understanding Openshift Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Understanding OVN-Kubernetes</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section2.html">Network Performance Testing with k8s-netperf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Ingress Controller Benchmarking and Analysis</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter5/index.html">Control Plane and Scalability Testing with kube-burner</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter5/section1.html">Configuring kube-burner jobs to simulate cluster churn</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter5/section2.html">Measuring Control Plane Responsiveness</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter5/section3.html">Hands-on with kube-burner</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter6/index.html">Final Review and Key Takeaways</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter6/section1.html">Final review</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix and References</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift performance benchmarking guide</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift performance benchmarking guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift performance benchmarking guide</a></li>
    <li><a href="index.html">Understanding Openshift Networking</a></li>
    <li><a href="section2.html">Network Performance Testing with k8s-netperf</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Network Performance Testing with k8s-netperf</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/cloud-bulldozer/k8s-netperf/">k8s-netperf</a> is an open-source tool designed to make it easy to run networking performance tests against your OpenShift clusters. It&#8217;s built by the team at Red Hat who contribute to the <a href="https://github.com/cloud-bulldozer">cloud-bulldozer</a> organization, and it&#8217;s a powerful and simple way to understand how your network is performing and to identify any potential bottlenecks.</p>
</div>
<div class="paragraph">
<p>Red Hat OpenShift&#8217;s development team is constantly updating and improving its source code and the Kernel networking data-path is part of that source code! In order to ensure the OpenShift network performance stays lightning fast, we have k8s-netperf running constantly on new releases of OpenShift in our pipeline.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_getting_started_with_k8s_netperf"><a class="anchor" href="#_quick_getting_started_with_k8s_netperf"></a>Quick Getting Started with k8s-netperf</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Getting started with k8s-netperf is a straightforward process. Here&#8217;s a quick guide to get you up and running:</p>
</div>
<div class="sect2">
<h3 id="_1_installation_build_from_git"><a class="anchor" href="#_1_installation_build_from_git"></a>1. Installation - Build from git</h3>
<div class="paragraph">
<p>First, you&#8217;ll need to clone the <a href="https://github.com/cloud-bulldozer/k8s-netperf">k8s-netperf repository</a> from GitHub and build the binary. You can do this with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/cloud-bulldozer/k8s-netperf.git
cd k8s-netperf
make build</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_node_labeling_optional"><a class="anchor" href="#_2_node_labeling_optional"></a>2. Node Labeling (Optional)</h3>
<div class="paragraph">
<p>k8s-netperf schedules a client and a server pod in your OpenShift cluster to run the network throughput and latency tests. Allowing for node labeling allows the user to control which nodes the network performance tests run on â€“ for example to not cross regions or availability zones, which could lead to higher latency. To also ensure that these pods land on the correct nodes, you use node labels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc label nodes &lt;client-node-name&gt; netperf=client
oc label nodes &lt;server-node-name&gt; netperf=server</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_namespace_and_service_account_optional"><a class="anchor" href="#_3_namespace_and_service_account_optional"></a>3. Namespace and Service Account (Optional)</h3>
<div class="paragraph">
<p>You&#8217;ll need a dedicated namespace and service account for k8s-netperf. You can create them with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create ns netperf
oc create sa -n netperf netperf</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you plan to run tests with hostNetwork enabled, you&#8217;ll need to grant the netperf service account additional permissions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_your_first_test"><a class="anchor" href="#_running_your_first_test"></a>Running Your First Test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the setup complete, you&#8217;re now ready to run your first network performance test. k8s-netperf offers a wide range of options to customize your tests. Here&#8217;s a basic example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./bin/k8s-netperf --all</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will run a comprehensive set of tests, including TCP and UDP stream tests, as well as request/response tests.</p>
</div>
<div class="paragraph">
<p>Here are some of the most useful command-line options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--across</code>: Forces the client and server pods to be scheduled across different availability zones.</p>
</li>
<li>
<p><code>--json</code>: Outputs the test results in JSON format, which is great for parsing with tools like jq.</p>
</li>
<li>
<p><code>--clean=true</code>: Deletes all of the resources created by k8s-netperf after the tests are complete.</p>
</li>
<li>
<p><code>--metrics</code>: Displays Prometheus metrics in the standard output.</p>
</li>
<li>
<p><code>--iperf</code>: Uses iperf3 as the load driver for stream tests.</p>
</li>
<li>
<p><code>--uperf</code>: Uses uperf as the load driver for stream tests.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_usage"><a class="anchor" href="#_advanced_usage"></a>Advanced Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>k8s-netperf also supports more advanced use cases, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Testing with <strong>Virtual Machines</strong>: If you&#8217;re using OpenShift CNV, you can run network performance tests between virtual machines.</p>
</li>
<li>
<p>Using a <strong>Linux Bridge Interface</strong>: The <code>--bridge</code> option allows you to test network performance over a Linux bridge interface.</p>
</li>
<li>
<p>Integrating with <strong>Prometheus</strong>: You can use the <code>--prom</code> option to specify a Prometheus URL for scraping metrics.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interpreting_the_results"><a class="anchor" href="#_interpreting_the_results"></a>Interpreting the Results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The output of k8s-netperf will vary depending on the tests you run. However, you&#8217;ll typically see metrics such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Throughput: The amount of data that can be transferred over the network in a given amount of time.</p>
</li>
<li>
<p>Latency: The time it takes for a packet to travel from the client to the server and back.</p>
</li>
<li>
<p>Packet Loss: The percentage of packets that are lost during transmission.</p>
</li>
<li>
<p>CPU Usage: The amount of CPU that is consumed by the client and server pods during the tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By analyzing these metrics, you can gain valuable insights into the performance of your OpenShift network. You can use this information to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify and troubleshoot network bottlenecks.</p>
</li>
<li>
<p>Compare the performance and overhead of different CNI plugins.</p>
</li>
<li>
<p>Optimize your network configuration for better performance, like increased MTU.</p>
</li>
<li>
<p>Ensure that your network can handle the demands of your applications.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>k8s-netperf is an essential tool for any engineer who is serious about OpenShift network performance. It&#8217;s easy to use, yet powerful enough to provide you with the insights you need to optimize your network and ensure that your applications are running at their best.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section1.html">Understanding OVN-Kubernetes</a></span>
  <span class="next"><a href="section3.html">Ingress Controller Benchmarking and Analysis</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
