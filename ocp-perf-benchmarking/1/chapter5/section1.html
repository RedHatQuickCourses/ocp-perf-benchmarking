<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring kube-burner jobs to simulate cluster churn :: OpenShift performance benchmarking guide</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="section2.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift performance benchmarking guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-perf-benchmarking/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-perf-benchmarking" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift performance benchmarking guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Introduction to performance benchmarking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Kubernetes/OpenShift performance landscape</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter2/index.html">Built-in OpenShift monitoring stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter3/index.html">Benchmarking suites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section1.html">Kubernetes-native benchmarking tools</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter4/index.html">Benchmarking the data plane</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter4/section1.html">Understanding OVN-Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter4/section2.html">Network throughput and latency testing with k8s-netperf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter4/section3.html">Ingress controller benchmarking</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Control plane and scalability testing with kube-burner</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section1.html">Configuring kube-burner jobs to simulate cluster churn</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Measuring Control Plane Responsiveness</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Hands-on with kube-burner</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter6/index.html">Final review</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter6/section1.html">Final review</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift performance benchmarking guide</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift performance benchmarking guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift performance benchmarking guide</a></li>
    <li><a href="index.html">Control plane and scalability testing with kube-burner</a></li>
    <li><a href="section1.html">Configuring kube-burner jobs to simulate cluster churn</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring kube-burner jobs to simulate cluster churn</h1>
<div class="sect1">
<h2 id="_understanding_and_setting_up_cluster_churn_simulation_with_kube_burner"><a class="anchor" href="#_understanding_and_setting_up_cluster_churn_simulation_with_kube_burner"></a>Understanding and Setting Up Cluster Churn Simulation with kube-burner</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kube-burner, a Golang-based tool, is designed to stress Kubernetes clusters by creating, deleting, and patching resources at a specified rate. This feature makes it an ideal instrument for simulating cluster churn â€“ the process of adding or removing significant numbers of pods, services, or other objects in a short period, which can impact the control plane&#8217;s responsiveness.</p>
</div>
<div class="paragraph">
<p>To configure kube-burner jobs for simulating cluster churn, you need to define specific settings within its configuration file or via command line flags. This section will guide you through these configurations step by step using practical examples.</p>
</div>
<div class="sect2">
<h3 id="_1_configuration_basics"><a class="anchor" href="#_1_configuration_basics"></a>1. Configuration Basics</h3>
<div class="paragraph">
<p>Start by understanding the global and job-specific settings in your kube-burner configuration file (<code>kube-burner.yaml</code> or provided as a flag when invoking <code>kube-burner init</code>). Here are some key parameters to consider:</p>
</div>
<div class="sect3">
<h4 id="_global_settings"><a class="anchor" href="#_global_settings"></a>Global Settings</h4>
<div class="ulist">
<ul>
<li>
<p><code>writeToFile</code>: A boolean that determines if metrics should be written to files (default is <code>true</code>).</p>
</li>
<li>
<p><code>metricsDirectory</code>: The directory where collected metrics will be stored (default is <code>collected-metrics</code>).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_job_specific_settings"><a class="anchor" href="#_job_specific_settings"></a>Job-specific Settings</h4>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: A unique identifier for the job.</p>
</li>
<li>
<p><code>jobIterations</code>: The number of times this job should run.</p>
</li>
<li>
<p><code>qps</code> (Queries Per Second): Controls the rate at which operations are performed (e.g., creating or deleting objects).</p>
</li>
<li>
<p><code>burst</code>: Specifies the maximum burst above the qps rate.</p>
</li>
<li>
<p><code>namespacedIterations</code>: A boolean to indicate if iterations should be namespace-specific.</p>
</li>
<li>
<p><code>cleanup</code>: Determines whether resources created during a job iteration should be cleaned up afterward.</p>
</li>
<li>
<p><code>namespace</code>: The target namespace for the job&#8217;s operations.</p>
</li>
<li>
<p><code>jobPause</code>: The duration between successive iterations of the job.</p>
</li>
<li>
<p><code>objects</code>: An array specifying object templates and their configurations, including the number of replicas.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_configuring_cluster_churn_simulation"><a class="anchor" href="#_2_configuring_cluster_churn_simulation"></a>2. Configuring Cluster Churn Simulation</h3>
<div class="paragraph">
<p>To simulate cluster churn, we&#8217;ll focus on creating and deleting objects (e.g., deployments) rapidly. Here&#8217;s an example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">global:
  writeToFile: true
  metricsDirectory: collected-metrics
jobs:
  - name: cluster-churn-job
    jobIterations: 5
    qps: 20
    burst: 40
    namespacedIterations: true
    cleanup: true
    namespace: kube-burner-job-ns
    jobPause: 1s
    objects:
      - objectTemplate: objectTemplates/deployment.yml
        replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this setup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We define a job named <code>cluster-churn-job</code>.</p>
</li>
<li>
<p>The job will run five iterations (<code>jobIterations</code>).</p>
</li>
<li>
<p>It aims to create or delete resources at a rate of 20 operations per second (<code>qps</code>) with occasional bursts up to 40 operations/second (<code>burst</code>).</p>
</li>
<li>
<p>Each iteration occurs in a different namespace (<code>namespacedIterations</code> is set to <code>true</code>), allowing for targeted churn testing.</p>
</li>
<li>
<p>Resources are cleaned up after each iteration (<code>cleanup: true</code>).</p>
</li>
<li>
<p>The job pauses for one second between iterations (<code>jobPause: 1s</code>) to avoid overwhelming the control plane and measure its responsiveness accurately.</p>
</li>
<li>
<p>A single deployment object with one replica is created per iteration (<code>objects</code>).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_3_running_the_simulation"><a class="anchor" href="#_3_running_the_simulation"></a>3. Running the Simulation</h3>
<div class="paragraph">
<p>Execute kube-burner with your configuration file using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kube-burner init -f kube-burner.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kube-burner will start simulating cluster churn according to your defined parameters, allowing you to observe and measure the control plane&#8217;s responsiveness under load.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h3>
<div class="paragraph">
<p>By carefully configuring kube-burner jobs, you can simulate realistic cluster churn scenarios and assess how well your Kubernetes control plane performs under various stress conditions. Remember to adjust parameters like <code>qps</code>, <code>burst</code>, and object types as needed for targeted testing in diverse environments.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Control plane and scalability testing with kube-burner</a></span>
  <span class="next"><a href="section2.html">Measuring Control Plane Responsiveness</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
