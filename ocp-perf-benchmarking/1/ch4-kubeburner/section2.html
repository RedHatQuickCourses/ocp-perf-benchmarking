<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring kube-burner jobs to simulate cluster churn :: OpenShift performance benchmarking guide</title>
    <link rel="prev" href="section1.html">
    <link rel="next" href="section3.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift performance benchmarking guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-perf-benchmarking/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-perf-benchmarking" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift performance benchmarking guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-intro/index.html">Introduction to Performance Benchmarking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/section1.html">Kubernetes/OpenShift performance landscape</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-monitoring/index.html">Monitoring OpenShift Performance with the Built-in Stack</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-monitoring/section1.html">Hands-on lab: Exploring the OpenShift monitoring stack</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-bench/index.html">Overview of Benchmarking Suites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-bench/section1.html">Kubernetes-native benchmarking tools</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Control Plane and Scalability Testing with kube-burner</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Measuring Control Plane Responsiveness</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section2.html">Configuring kube-burner jobs to simulate cluster churn</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Hands-on with kube-burner</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch5-network/index.html">Understanding Openshift Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch5-network/section1.html">Understanding OVN-Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch5-network/section2.html">Network Performance Testing with k8s-netperf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch5-network/section3.html">Ingress Controller Benchmarking and Analysis</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ch6-final/index.html">Final Review and Key Takeaways</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift performance benchmarking guide</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift performance benchmarking guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift performance benchmarking guide</a></li>
    <li><a href="index.html">Control Plane and Scalability Testing with kube-burner</a></li>
    <li><a href="section2.html">Configuring kube-burner jobs to simulate cluster churn</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring kube-burner jobs to simulate cluster churn</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Cluster churn is a critical real-world behavior where workloads are continuously created and deleted. Simulating this behavior helps uncover issues in scheduling, garbage collection, API performance, controller reconciliation, and control-plane stability. kube-burner provides native support for controlled workload churning to model these conditions at scale.</p>
</div>
<div class="paragraph">
<p>This tutorial walks you through what churn is, how it works, and exactly how to configure it in kube-burner.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_churn_in_kube_burner"><a class="anchor" href="#_what_is_churn_in_kube_burner"></a>What is churn in kube-burner?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In kube-burner, churn refers to the <strong>cyclic deletion and re-creation of workloads</strong> after the initial job completes.</p>
</div>
<div class="paragraph">
<p><strong>Churning</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Randomly selects a subset of namespaces or objects</p>
</li>
<li>
<p>Deletes them</p>
</li>
<li>
<p>Recreates them using the original job templates</p>
</li>
<li>
<p>Repeats this process for a defined duration or number of cycles</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>This simulates</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Auto-scaling environments</p>
</li>
<li>
<p>CI/CD redeployments</p>
</li>
<li>
<p>Unstable or bursty workloads</p>
</li>
<li>
<p>Real-world production traffic patterns</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Churn is supported only for create jobs and only for namespace-based jobs.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_should_you_use_churn"><a class="anchor" href="#_when_should_you_use_churn"></a>When should you use churn?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should enable churning when testing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>API server behavior under continuous load</p>
</li>
<li>
<p>Scheduler and controller stability</p>
</li>
<li>
<p>Namespace lifecycle performance</p>
</li>
<li>
<p>Garbage collection efficiency</p>
</li>
<li>
<p>Control plane memory and CPU leaks</p>
</li>
<li>
<p>Network and CNI stability under load</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Churn is especially valuable for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Long-running soak tests</p>
</li>
<li>
<p>Scale-down/scale-up stress tests</p>
</li>
<li>
<p>Multi-tenant simulation environments</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_churn_configuration_example"><a class="anchor" href="#_basic_churn_configuration_example"></a>Basic churn configuration example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates 100 namespaces</p>
</li>
<li>
<p>Churns 20% of them</p>
</li>
<li>
<p>Runs for 2 hours</p>
</li>
<li>
<p>Recreates 10 Deployments and 10 Services per namespace</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jobs:
- name: churning-job
  jobIterations: 100
  namespacedIterations: true
  namespace: churn-test

  churnConfig:
    percent: 20
    duration: 2h

  objects:
  - objectTemplate: deployment.yml
    replicas: 10

  - objectTemplate: service.yml
    replicas: 10</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>What Happens Here?</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>kube-burner creates 100 namespaces</p>
</li>
<li>
<p>Each namespace gets:</p>
<div class="ulist">
<ul>
<li>
<p>10 Deployments</p>
</li>
<li>
<p>10 Services</p>
</li>
</ul>
</div>
</li>
<li>
<p>After job completion:</p>
<div class="ulist">
<ul>
<li>
<p>20 namespaces (20%) are randomly selected</p>
</li>
<li>
<p>They are deleted and recreated</p>
</li>
</ul>
</div>
</li>
<li>
<p>This cycle continues for 2 hours</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_termination_conditions"><a class="anchor" href="#_termination_conditions"></a>Termination conditions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Churn stops when either condition is met first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>duration</code> - Total time to keep churning</p>
</li>
<li>
<p><code>cycles</code> - Total number of churn cycles</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_cycle_based_churn"><a class="anchor" href="#_cycle_based_churn"></a>Cycle-based churn</h3>
<div class="paragraph">
<p>The following configuration churn runs exactly 10 iterations, regardless of time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">churnConfig:
  percent: 30
  cycles: 10</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_duration_based_churn"><a class="anchor" href="#_duration_based_churn"></a>Duration-based churn</h3>
<div class="paragraph">
<p>Churn runs only by time, ignoring cycles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">churnConfig:
  percent: 25
  duration: 1h
  cycles: 0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delay_between_cycles"><a class="anchor" href="#_delay_between_cycles"></a>Delay between cycles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can pause between churn operations using <code>delay</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">churnConfig:
  percent: 20
  duration: 1h
  delay: 2m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each churn wave waits 2 minutes before starting the next delete/recreate cycle.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_namespace_vs_object_modes"><a class="anchor" href="#_namespace_vs_object_modes"></a>Namespace vs Object modes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, kube-burner churns entire namespaces. You can switch to object-level churning with <code>mode: objects</code>.</p>
</div>
<div class="sect2">
<h3 id="_namespace_churn_default"><a class="anchor" href="#_namespace_churn_default"></a>Namespace churn (default)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">churnConfig:
  percent: 20
  mode: namespaces</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Deletes and recreates entire namespaces</p>
</li>
<li>
<p>Heaviest load on API server and controllers</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_object_level_churn"><a class="anchor" href="#_object_level_churn"></a>Object-level churn</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">churnConfig:
  percent: 20
  mode: objects</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Deletes objects only inside namespaces</p>
</li>
<li>
<p>Namespaces remain intact</p>
</li>
<li>
<p>Better for application-level chaos testing</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_excluding_specific_objects"><a class="anchor" href="#_excluding_specific_objects"></a>Excluding specific objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some objects should never be deleted, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RBAC</p>
</li>
<li>
<p>CRDs</p>
</li>
<li>
<p>Storage classes</p>
</li>
<li>
<p>Base networking objects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can disable churn per object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">objects:
- objectTemplate: deployment.yml
  replicas: 10
  churn: false

- objectTemplate: service.yml
  replicas: 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Deployment will never be deleted during churn, but Services will.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_example"><a class="anchor" href="#_advanced_example"></a>Advanced example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates 200 namespaces</p>
</li>
<li>
<p>Churns 15% of them</p>
</li>
<li>
<p>Runs for 90 minutes</p>
</li>
<li>
<p>Waits 1 minute between churn cycles</p>
</li>
<li>
<p>Churns only objects</p>
</li>
<li>
<p>Protects one critical object</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jobs:
- name: advanced-churn
  jobIterations: 200
  namespacedIterations: true
  namespace: advanced-churn

  churnConfig:
    percent: 15
    duration: 90m
    delay: 1m
    mode: objects

  objects:
  - objectTemplate: critical-config.yml
    replicas: 1
    churn: false

  - objectTemplate: workload.yml
    replicas: 20

  - objectTemplate: service.yml
    replicas: 20</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_rules_and_constraints"><a class="anchor" href="#_key_rules_and_constraints"></a>Key rules and constraints</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Churn only works for create jobs</p>
</li>
<li>
<p>Requires namespaced iterations</p>
</li>
<li>
<p>Either cycles or duration must be set</p>
</li>
<li>
<p>Churn happens after job completion, before the metrics upload</p>
</li>
<li>
<p>Works with both namespace-level and object-level deletion</p>
</li>
<li>
<p>Cannot be used with:</p>
<div class="ulist">
<ul>
<li>
<p>Job types other than <code>create</code></p>
</li>
<li>
<p>Cluster-scoped only objects</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>kube-burner&#8217;s churning feature allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simulate real production instability</p>
</li>
<li>
<p>Stress test control-plane resilience</p>
</li>
<li>
<p>Validate cleanup, GC, and reconciliation logic</p>
</li>
<li>
<p>Detect scaling issues early</p>
</li>
<li>
<p>Perform chaos-like testing without external tools</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is a first-class primitive for realistic k8s performance testing and should be part of any serious scale or soak test strategy.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section1.html">Measuring Control Plane Responsiveness</a></span>
  <span class="next"><a href="section3.html">Hands-on with kube-burner</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
